<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>筹课活动</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="screen-orientation" content="portrait">
    <meta http-equiv="pragma" content="no-cache" />
    <meta itemprop="name" content="筹课"/>
    <meta itemprop="description" name="description"  content="筹课"/>
    <meta content="telephone=no" name="format-detection" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="{$publicserver}/public/chouke/css/raiseClass/style.css">
    <script src="{$publicserver}/public/gouke/app/js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="{$publicserver}/public/gouke/app/js/layer/layer.js" type="text/javascript"></script>
    <link rel="stylesheet" href="{$publicserver}/public/gouke/app/js/layer/skin/layer.css">
    
     <script>
  var PREFIX_URL = "http://{$domain}/chouke/";
  var PREFIX_PUBLIC_URL = "{$publicserver}/public/chouke/";
  var Global = {
		    //rsa_key : "-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQChTJiIJhxAdNPob/F2Cj6uJdsWHaC2fqkQptR/bkzhCCWAUFSqc0kwtve6aEFOFXWCvIuEDQKw5QYcyOCpImIobss+rHVRlVRNO2ARuZfpMx3KZ+BNnI0OnZvztRr5sJIdiP/VRTGAkwHgcnKV236jC62ga/pGI9cenqPcuZXfeQIDAQAB-----END PUBLIC KEY-----",
			rsa_key : "A14C9888261C4074D3E86FF1760A3EAE25DB161DA0B67EA910A6D47F6E4CE10825805054AA734930B6F7BA68414E157582BC8B840D02B0E5061CC8E0A92262286ECB3EAC755195544D3B6011B997E9331DCA67E04D9C8D0E9D9BF3B51AF9B0921D88FFD54531809301E0727295DB7EA30BADA06BFA4623D71E9EA3DCB995DF79",
			encryption : "10001",
		    decryption : "10001",
		    appId : "d2bff756072b40e0ba7951284169ec1f",
		    actionURL:PREFIX_URL+"ajax_service",
		    previewURL:PREFIX_URL+"appindexpre?channel=Wechat&activityId=",
			previewURL_new:PREFIX_URL+"raiseclassnewpre?activityId=",
		    baseUploadPath:"",//http://xshow.xdf.cn/chouke/
		    cartID:"iPocketXDFApp",
		    //buyDomain:"http://online.bm.staff.xdf.cn"//测试
		    buyDomain:"http://bm.xdf.cn"//正式
	};
  Global.headImgurl='./images/raiseClass/photo_default.png';//取app的头像
  Global.domain_uh='http://my.xdf.cn/API_Avatar/img';//
  //Global.wechatUrl = 'http://apphome.xdf.cn/xdfhome/';//正式
  Global.wechatUrl = 'http://apphome.staff.xdf.cn/xdfhome/';//测试
  Global.appid='';
  Global.secret='';
  Global.redirect_uri="http://{$domain}/chouke/"
  Global.openappid='';

  Global.openid = '{$openid}';
  Global.nickname = '{$nickname}';
  Global.headimgurl = '{$headimgurl}';

  Global.userId = '{$userId}';
  Global.mobile = '{$mobile}';
  Global.id ='{$activity.activityId}';
  	</script>
</head>
<body>

<div class="raiseTitle">
    <span class="back"><img src="{$publicserver}/public/chouke/images/raiseClass/xsckBack.png" />返回</span>
    <h3>帮筹福利</h3>
</div>
<section class="page page-animation page-yellow page_height" style="padding-bottom:40px;">
    <div class="page-container pb54">
        <header class="page-cow6">
            <img src="{$publicserver}/public/chouke/images/raiseClass/radiation-small7.jpg" />
        </header>

		<div id="succhint" style="text-align:center;width:200px;margin:auto;font-weight:bold;color:red;font-size:1rem;line-height:1.1rem;display:{if $trial}block{else}none{/if};">
		<p>恭喜！！！</p>
		<p>领取福利成功！</p>
		</div>
		
        {if $activity.helpWealSwitch eq 1}
        <div style="padding:20px;">
		<div style="background:#33cd99;">
			<div style="padding:20px;font-size:0.9rem;line-height:1.1rem;">
				<p style="font-weight:bold;font-size:1.1rem;">{$activity.wealName}<p>
				<p style="margin-top:10px;line-height:40px;">{$activity.wealRemark}</p>
			</div>
		</div>
		<div style="padding:20px;font-size:0.9rem;line-height:1.1rem;">
		{$activity.wealIntroduce}
		</div>
		</div>
		{/if}
    </div>

	<div class="fixed fixed-b"  id="trialed" style="display:{if $trial}block{else}none{/if};">
        <div class="container-fluid white footer-select ybc_footer-select">
            <p class="text-center fl" id="goindex1" style="width: 100%">太棒了！</p>
        </div>
    </div>
	
	
    <div class="fixed fixed-b" id="nottrialed" style="display:{if $trial}none{else}block{/if};">
        <div class="container-fluid white footer-select ybc_footer-select">
            <p class="text-center fl" id="goindex2">我再想想</p>
            <p class="text-center fl" id="gotrial">我要报名</p>
            
        </div>
    </div>
   
</section>

<div class="mask"></div>
<div class="tan-chouke-launch">
    <h1>输入手机号，马上参加活动！
        <span class="close"><img src="{$publicserver}/public/gouke/app/images/close1.png" /></span>
    </h1>
    <div class="name-box">
        <ul class="list1">
            <li><input type="text" class="inp tel" placeholder="请输入手机号码" /></li>
            <li style="margin-top:5px;border-top:1px solid #d9d9d9;">
                <input type="text" class="inp sms" style="width:120px;" placeholder="请输入短信码" />
                &nbsp;<span class="yanzm2">发送验证码</span>
            </li>
        </ul>
        <p class="error-red"></p>
        <input type="button" value="确定" class="button-ok" />
        <p class="text-tips">
            请录入您的手机号号码作为中奖凭证提交，您的信息仅作为新东方本次活动登记信息使用，并全程保密。
        </p>
    </div>
</div>

<script>

$('.yanzm2').on('touchend',function(){
    var $this = $(this);
    verifySMS($this);
})
$(document).on('touchend','.close',function(){
	$(".mask").hide();
	var $this = $(this);
    if($this.hasClass('on')){
    	$this.removeClass('on');
    }
	$('.tan-chouke-launch').hide();
});
$('#gotrial').on('touchend',function(){
	enroll();
})

$('#goindex1').on('touchend',function(){
	location.href='appindex?activityId='+Global.id+"&userId="+Global.userId;
})
$('#goindex2').on('touchend',function(){
	location.href='appindex?activityId='+Global.id+"&userId="+Global.userId;
})

function enroll(){
		$(".mask").show();
        $(".tan-chouke-launch").animate({ 'bottom': '0px' });
        //点击确定
        $('.tan-chouke-launch').show();
        $('.yanzm2').removeClass('on');
        $('.tan-chouke-launch .button-ok').on('touchend',function(){
            var $this = $(this);
            if($this.hasClass('on')){
                return false
            }
            
            $this.addClass('on');
            var mobile = $('.tan-chouke-launch .tel').val();
            var smsCode = $('.tan-chouke-launch .sms').val();
            //判断
            if(mobile==''){
                $('.error-red').html('手机号不能为空');
                $this.removeClass('on');
                return false
            }else if(smsCode==''){
                $('.error-red').html('验证码不能为空');
                $this.removeClass('on');
                return false
            }else if(!/^[1][3578][0-9]{9}$/.test(mobile)){
                $('.error-red').html('手机号格式不正确');
                $this.removeClass('on');
                return false
            }

            var businessP = {"mobile":mobile,"smsCode":smsCode,"aid":Global.id};
            jQuery.ajax({
                type: "POST",
                url: 'ajax_choukesmslogin',
                async: true,
                dataType: 'json',
                data: JSON.stringify(businessP),
                success: function (json) {
                    if(json.result==true){
                        if(json.data.Status==1){//成功 开始发起
                        	$(".mask").hide();
                        	$('#nottrialed').hide();
                        	$('.tan-chouke-launch').hide();
                        	$('#trialed').show();
                        	$('#succhint').show();
                        }else{
                            $('.error-red').html(json.data.Message);
                        }
                    }else{
                        $('.error-red').html(json.data.Message);
                    }
                    $this.removeClass('on');
                },error:function(){
                    layer.msg('网络不给力，换个姿势再试一下');
                    $this.removeClass('on');
                }
            })
        })
}    

function verifySMS($this){
	if($this.hasClass('on')){
        return false
    }
    $this.addClass('on');
    var mobile = $('.tan-chouke-launch .tel').val();
    //判断
    if(mobile==''){
        $('.error-red').html('手机号不能为空');
        $this.removeClass('on');
        return false
    }else if(!/^[1][3578][0-9]{9}$/.test(mobile)){
        $('.error-red').html('手机号格式不正确');
        $this.removeClass('on');
        return false
    }

    var businessP = {"mobile":mobile};
    jQuery.ajax({
        type: "POST",
        url: 'ajax_goukesendsms',
        async: true,
        dataType: 'json',
        data: JSON.stringify(businessP),
        success: function (json) {
            if(json.result==true){
                if(json.data.Status==1){
                    layer.msg('验证码发送成功！');
                    var countdown=60;
                    function settimeFn() {
                        var cdDom=$('.yanzm2');
                        if (countdown == 0) {
                            cdDom.html("发送验证码");
                            countdown = 60;
                            cdDom.removeClass('on');
                            return;
                        } else {
                            cdDom.addClass('on');
                            cdDom.html('重新发送(' + countdown + ')')
                            countdown--;
                        }
                        setTimeout(function() {
                            settimeFn();
                        },1000)
                    }
                    settimeFn();
                }else{
                    $('.error-red').html(JSON.parse(json.data).Message);
                    $this.removeClass('on');
                }
            }else{
                $('.error-red').html(JSON.parse(json.data).Message);
                $this.removeClass('on');
            }
        }
    })
}

</script>
</body>
</html>